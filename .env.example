# =============================================================================
# CV Landing Page Generator - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# =============================================================================
# REQUIRED CONFIGURATION
# =============================================================================

# Environment Mode
# Values: development | production
NODE_ENV=development

# Server Port
PORT=3000

# =============================================================================
# DATABASE CONFIGURATION (REQUIRED)
# =============================================================================

# Supabase Database URL
# Get from: Supabase Dashboard → Settings → Database → Connection String (URI)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://your_user:your_password@db.your-project.supabase.co:5432/postgres

# Database Connection Pool Settings (Free Tier Optimized)
# Supabase free tier limit: 100 connections total
DATABASE_MAX_CONNECTIONS=5
DATABASE_IDLE_TIMEOUT=30000
DATABASE_CONNECTION_TIMEOUT=3000
DATABASE_ACQUIRE_TIMEOUT=5000

# =============================================================================
# AUTHENTICATION CONFIGURATION (REQUIRED)
# =============================================================================

# JWT Secret (REQUIRED)
# Generate a strong secret with:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=your_strong_jwt_secret_minimum_32_characters_required

# JWT Token Expiration
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Session Configuration
MAX_SESSIONS_PER_USER=5
SESSION_TIMEOUT_MS=86400000

# Internal Processing Token (for server-to-server communication)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
INTERNAL_PROCESSING_TOKEN=your_internal_processing_token_here

# =============================================================================
# GOOGLE OAUTH CONFIGURATION (REQUIRED)
# =============================================================================

# Get credentials from: https://console.cloud.google.com/apis/credentials
# 1. Create OAuth 2.0 Client ID
# 2. Add authorized redirect URIs:
#    - http://localhost:3000/api/auth/google/callback (development)
#    - https://your-domain.com/api/auth/google/callback (production)

GOOGLE_CLIENT_ID=your_google_client_id_here.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret_here

# =============================================================================
# ENCRYPTION CONFIGURATION (REQUIRED FOR GITHUB INTEGRATION)
# =============================================================================

# Encryption Key for Sensitive Data (GitHub tokens, etc.)
# MUST be 64 hex characters (32 bytes)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=your_64_character_hex_encryption_key_here_must_be_exactly_64_chars

# =============================================================================
# LLM CONFIGURATION (REQUIRED)
# =============================================================================

# LLM Provider Selection
# Values: gemini | ollama
LLM_CLIENT_TYPE=gemini

# --- Gemini Configuration (if LLM_CLIENT_TYPE=gemini) ---
# Get API key from: https://makersuite.google.com/app/apikey
# Free tier: 60 requests per minute
GEMINI_API_KEY=your_gemini_api_key_here

# Gemini Free Tier Limits
GEMINI_DAILY_LIMIT=50
GEMINI_MONTHLY_TOKEN_LIMIT=100000

# --- Ollama Configuration (if LLM_CLIENT_TYPE=ollama) ---
# Install from: https://ollama.ai/
# Pull a model: ollama pull mistral
# Start server: ollama serve
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=mistral:latest

# =============================================================================
# GITHUB INTEGRATION (OPTIONAL - for publishing to GitHub Pages)
# =============================================================================

# Get credentials from: https://github.com/settings/developers
# 1. Create OAuth App
# 2. Add authorization callback URL:
#    - http://localhost:3000/api/github/callback (development)
#    - https://your-domain.com/api/github/callback (production)

GITHUB_CLIENT_ID=your_github_client_id_here
GITHUB_CLIENT_SECRET=your_github_client_secret_here
GITHUB_REDIRECT_URI=http://localhost:3000/api/github/callback

# GitHub Rate Limiting
GITHUB_RATE_LIMIT=20

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# CORS - Allowed Origins (comma-separated)
# Add your frontend URL(s)
ALLOWED_ORIGINS=http://localhost:4200,http://localhost:3000

# Rate Limiting (per IP address)
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================


# Maximum File Size (bytes) - 50MB default
MAX_FILE_SIZE=52428800

# =============================================================================
# FILE CLEANUP CONFIGURATION (Free Tier Optimization)
# =============================================================================

# Uploaded Files Cleanup
UPLOADS_MAX_AGE_HOURS=2
UPLOADS_MAX_FILES=50
UPLOADS_CLEANUP_INTERVAL_HOURS=1

# Generated Files Cleanup
GENERATED_MAX_AGE_HOURS=12
GENERATED_MAX_FILES=100
GENERATED_CLEANUP_INTERVAL_HOURS=2

# Orphaned Files Check
ORPHANED_CHECK_INTERVAL_HOURS=4

# Immediate Cleanup (after download/process)
ENABLE_IMMEDIATE_CLEANUP=true
POST_DOWNLOAD_CLEANUP_MINUTES=5

# =============================================================================
# SYSTEM LIMITS (Free Tier Optimization)
# =============================================================================

# Memory Pressure Threshold (MB) - Free tier typically 512MB
MEMORY_PRESSURE_THRESHOLD=400

# =============================================================================
# VALIDATION NOTES
# =============================================================================
#
# REQUIRED VARIABLES - Must be set for the application to run:
# ✓ NODE_ENV
# ✓ PORT
# ✓ DATABASE_URL (Supabase connection string)
# ✓ JWT_SECRET (minimum 32 characters)
# ✓ GOOGLE_CLIENT_ID
# ✓ GOOGLE_CLIENT_SECRET
# ✓ LLM_CLIENT_TYPE (gemini or ollama)
# ✓ GEMINI_API_KEY (if using Gemini) OR OLLAMA_BASE_URL (if using Ollama)
#
# OPTIONAL BUT RECOMMENDED:
# - ENCRYPTION_KEY (required if using GitHub integration)
# - GITHUB_CLIENT_ID (if enabling GitHub publishing)
# - GITHUB_CLIENT_SECRET (if enabling GitHub publishing)
# - INTERNAL_PROCESSING_TOKEN (for enhanced security)
#
# VALIDATION COMMANDS:
# Test database connection:
#   npm run db:test
#
# Generate secure secrets:
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# =============================================================================
# GETTING API KEYS
# =============================================================================
#
# Google OAuth:
#   https://console.cloud.google.com/apis/credentials
#
# Gemini API:
#   https://makersuite.google.com/app/apikey
#
# GitHub OAuth:
#   https://github.com/settings/developers
#
# Supabase Database:
#   https://app.supabase.com/project/_/settings/database
#
# =============================================================================
# COMMON ISSUES
# =============================================================================
#
# 1. "JWT_SECRET must be at least 32 characters"
#    → Generate a new secret with the command above
#
# 2. "Database connection failed"
#    → Check DATABASE_URL is correct
#    → Verify Supabase project is active
#    → Run: npm run db:test
#
# 3. "Google OAuth error"
#    → Verify redirect URIs match in Google Console
#    → Check GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET are correct
#
# 4. "Gemini API error"
#    → Verify GEMINI_API_KEY is valid
#    → Check you haven't exceeded free tier limits
#
# 5. "ENCRYPTION_KEY must be 64 characters"
#    → Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# =============================================================================
